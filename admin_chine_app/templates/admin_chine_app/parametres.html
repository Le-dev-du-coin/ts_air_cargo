{% extends 'components/base_admin_chine.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}

{% block page_title %}{{ title }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <strong>Configuration Système :</strong> Gérez les paramètres globaux de la plateforme TS Air Cargo.
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Paramètres Généraux -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-cog"></i> Paramètres Généraux</h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="update_company">
                    <div class="mb-3">
                        <label for="company_name" class="form-label">Nom de l'entreprise</label>
                        <input type="text" class="form-control" id="company_name" name="company_name" value="{{ settings.company_name }}">
                    </div>
                    <div class="mb-3">
                        <label for="admin_email" class="form-label">Email administrateur</label>
                        <input type="email" class="form-control" id="admin_email" name="admin_email" value="{{ settings.admin_email }}">
                    </div>
                    <div class="mb-3">
                        <label for="timezone" class="form-label">Fuseau horaire</label>
                        <select class="form-select" id="timezone" name="timezone">
                            <option value="Africa/Bamako" {% if settings.timezone == 'Africa/Bamako' %}selected{% endif %}>Africa/Bamako (Mali)</option>
                            <option value="Asia/Shanghai" {% if settings.timezone == 'Asia/Shanghai' %}selected{% endif %}>Asia/Shanghai (Chine)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="currency" class="form-label">Devise par défaut</label>
                        <input type="text" class="form-control" id="currency" name="currency" value="{{ settings.currency }}">
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Paramètres de Transport -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-shipping-fast"></i> Transport & Tarifs</h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="update_transport">
                    <div class="mb-3">
                        <label class="form-label">Taux de frais par défaut</label>
                        <div class="input-group">
                            <input type="number" class="form-control" name="commission_rate" value="{{ settings.commission_rate }}" step="0.1" min="0" max="100">
                            <span class="input-group-text">%</span>
                        </div>
                        <small class="text-muted">Appliqué aux transferts d'argent</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Frais de change (Yuan → FCFA)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" name="exchange_rate" value="{{ settings.exchange_rate }}" step="0.1" min="0">
                            <span class="input-group-text">FCFA</span>
                        </div>
                        <small class="text-muted">1 Yuan = {{ settings.exchange_rate }} FCFA (indicatif)</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Délai de transport standard</label>
                        <div class="input-group">
                            <input type="number" class="form-control" name="delivery_time" value="{{ settings.delivery_time }}" min="1">
                            <span class="input-group-text">jours</span>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </form>
            </div>
            <div class="card-footer">
                <a href="{% url 'admin_chine_app:tarifs' %}" class="btn btn-outline-primary">
                    <i class="fas fa-tags"></i> Gérer les Tarifs
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mt-1">
    <!-- Notifications -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-bell"></i> Notifications</h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="update_notifications">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="email_notifications" name="email_notifications" {% if settings.email_notifications %}checked{% endif %}>
                        <label class="form-check-label" for="email_notifications">
                            Notifications par email
                        </label>
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="sms_notifications" name="sms_notifications" {% if settings.sms_notifications %}checked{% endif %}>
                        <label class="form-check-label" for="sms_notifications">
                            Notifications SMS
                        </label>
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="whatsapp_notifications" name="whatsapp_notifications" {% if settings.whatsapp_notifications %}checked{% endif %}>
                        <label class="form-check-label" for="whatsapp_notifications">
                            Notifications WhatsApp
                        </label>
                    </div>
                    <div class="mb-3">
                        <label for="notification_frequency" class="form-label">Fréquence des rapports</label>
                        <select class="form-select" id="notification_frequency" name="notification_frequency">
                            <option value="quotidien" {% if settings.notification_frequency == 'quotidien' %}selected{% endif %}>Quotidien</option>
                            <option value="hebdomadaire" {% if settings.notification_frequency == 'hebdomadaire' %}selected{% endif %}>Hebdomadaire</option>
                            <option value="mensuel" {% if settings.notification_frequency == 'mensuel' %}selected{% endif %}>Mensuel</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Sécurité -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-shield-alt"></i> Sécurité</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label">Durée de session</label>
                    <div class="input-group">
                        <input type="number" class="form-control" value="24" readonly>
                        <span class="input-group-text">heures</span>
                    </div>
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="two_factor_auth" disabled>
                    <label class="form-check-label" for="two_factor_auth">
                        Authentification à deux facteurs
                    </label>
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="login_logging" checked disabled>
                    <label class="form-check-label" for="login_logging">
                        Journalisation des connexions
                    </label>
                </div>
                <div class="mb-3">
                    <label for="password_policy" class="form-label">Politique de mot de passe</label>
                    <select class="form-select" id="password_policy" disabled>
                        <option selected>Standard (8 caractères min)</option>
                        <option>Renforcée (12 caractères + symboles)</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mt-1">
    <!-- Monitoring WhatsApp & Notifications -->
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fab fa-whatsapp me-2"></i> Monitoring WhatsApp & Notifications</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-success">
                            <div class="card-body text-center">
                                <i class="fab fa-whatsapp fa-3x text-success mb-3"></i>
                                <h5 class="card-title">Statistiques WhatsApp</h5>
                                <div class="row mb-3">
                                    <div class="col-6">
                                        <h4 class="text-success">{{ stats.whatsapp_envoyees }}</h4>
                                        <small>Envoyées avec succès</small>
                                    </div>
                                    <div class="col-6">
                                        <h4 class="text-danger">{{ stats.whatsapp_echecs }}</h4>
                                        <small>Échecs d'envoi</small>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-6">
                                        <p class="mb-1"><strong>Total messages:</strong></p>
                                        <h5 class="text-primary">{{ stats.whatsapp_total }}</h5>
                                    </div>
                                    <div class="col-6">
                                        <p class="mb-1"><strong>Taux de succès:</strong></p>
                                        <h5 class="text-success">{{ stats.taux_succes_whatsapp }}%</h5>
                                    </div>
                                </div>
                                <hr>
                                <div class="row text-center">
                                    <div class="col-6">
                                        <small class="text-muted">Aujourd'hui</small>
                                        <h6 class="text-info">{{ stats.whatsapp_aujourd_hui }}</h6>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Ce mois</small>
                                        <h6 class="text-info">{{ stats.whatsapp_ce_mois }}</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-info">
                            <div class="card-body text-center">
                                <i class="fas fa-tasks fa-3x text-info mb-3"></i>
                                <h5 class="card-title">Tâches de Notifications</h5>
                                <div class="row mb-3">
                                    <div class="col-4">
                                        <h5 class="text-success">{{ stats.success_notification_tasks }}</h5>
                                        <small>Terminées</small>
                                    </div>
                                    <div class="col-4">
                                        <h5 class="text-danger">{{ stats.failed_notification_tasks }}</h5>
                                        <small>Échouées</small>
                                    </div>
                                    <div class="col-4">
                                        <h5 class="text-warning">{{ stats.pending_notification_tasks }}</h5>
                                        <small>En attente</small>
                                    </div>
                                </div>
                                <hr>
                                <div class="text-center">
                                    <p class="mb-1"><strong>Total tâches traitées:</strong></p>
                                    <h4 class="text-primary">{{ stats.total_notification_tasks }}</h4>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-6">
                                        <small class="text-muted">En file d'attente</small>
                                        <h6 class="text-warning">{{ stats.whatsapp_en_attente }}</h6>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Taux succès global</small>
                                        <h6 class="text-success">{{ stats.taux_succes_tasks }}%</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mt-1">
    <!-- Sauvegarde -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-database"></i> Sauvegarde & Maintenance</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label">Dernière sauvegarde</label>
                    <p class="form-control-plaintext">{{ stats.last_backup }}</p>
                </div>
                <div class="mb-3">
                    <label class="form-label">Fréquence de sauvegarde</label>
                    <p class="form-control-plaintext">{{ stats.backup_frequency|title }}</p>
                </div>
                <div class="mb-3">
                    <label class="form-label">Rétention des sauvegardes</label>
                    <p class="form-control-plaintext">{{ stats.backup_retention }} jours</p>
                </div>
            </div>
            <div class="card-footer">
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="backup_data">
                    <button type="submit" class="btn btn-info">
                        <i class="fas fa-download"></i> Créer Sauvegarde
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Logs & Monitoring -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Logs & Monitoring</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label">Niveau de log</label>
                    <select class="form-select" disabled>
                        <option>DEBUG</option>
                        <option selected>INFO</option>
                        <option>WARNING</option>
                        <option>ERROR</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Espace disque utilisé</label>
                    <div class="progress">
                        <div class="progress-bar bg-{% if stats.disk_usage < 50 %}success{% elif stats.disk_usage < 80 %}warning{% else %}danger{% endif %}" role="progressbar" style="width: {{ stats.disk_usage }}%">{{ stats.disk_usage }}%</div>
                    </div>
                    <small class="text-muted">{% widthratio stats.disk_usage 100 10 as used_gb %}{{ used_gb }} GB / 10 GB</small>
                </div>
                <div class="mb-3">
                    <label class="form-label">Connexions actives</label>
                    <p class="form-control-plaintext">
                        <span class="badge bg-success">{{ stats.users_connected }} utilisateurs connectés</span>
                    </p>
                </div>
                <div class="mb-3">
                    <label class="form-label">Monitoring Transferts d'Argent</label>
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li><i class="fas fa-exchange-alt text-primary"></i> Total transferts: <strong>{{ stats.total_transferts }}</strong></li>
                                <li><i class="fas fa-check-circle text-success"></i> Confirmés: <strong>{{ stats.transferts_confirmes }}</strong></li>
                                <li><i class="fas fa-clock text-warning"></i> En cours: <strong>{{ stats.transferts_en_cours }}</strong></li>
                                <li><i class="fas fa-calendar-day text-info"></i> Aujourd'hui: <strong>{{ stats.transferts_aujourd_hui }}</strong></li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li><i class="fas fa-money-bill-wave text-success"></i> Total FCFA: <strong>{{ stats.montant_total_fcfa|floatformat:0 }}</strong></li>
                                <li><i class="fas fa-yen-sign text-primary"></i> Total Yuan: <strong>{{ stats.montant_total_yuan|floatformat:0 }}</strong></li>
                                <li><i class="fas fa-percentage text-info"></i> Taux confirmation: <strong>{{ stats.taux_confirmation }}%</strong></li>
                                <li><i class="fas fa-credit-card text-warning"></i> Frais totaux: <strong>{{ stats.frais_totaux|floatformat:0 }}</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Méthodes de Transfert - Western Union & MoneyGram</label>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card border-primary">
                                <div class="card-body text-center">
                                    <i class="fas fa-building fa-2x text-primary mb-2"></i>
                                    <h5 class="card-title">Western Union</h5>
                                    <p class="card-text">
                                        <strong>{{ stats.western_union_count }}</strong> transferts<br>
                                        <span class="text-success">{{ stats.western_union_montant|floatformat:0 }} FCFA</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-success">
                                <div class="card-body text-center">
                                    <i class="fas fa-money-check fa-2x text-success mb-2"></i>
                                    <h5 class="card-title">MoneyGram</h5>
                                    <p class="card-text">
                                        <strong>{{ stats.moneygram_count }}</strong> transferts<br>
                                        <span class="text-success">{{ stats.moneygram_montant|floatformat:0 }} FCFA</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Répartition des Utilisateurs</label>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-users text-primary"></i> Total agents: <strong>{{ stats.total_agents }}</strong></li>
                        <li>&nbsp;&nbsp;&nbsp;<i class="fas fa-user-tie text-info"></i> Agents Mali: <strong>{{ stats.agents_mali }}</strong></li>
                        <li>&nbsp;&nbsp;&nbsp;<i class="fas fa-user-friends text-warning"></i> Agents Chine: <strong>{{ stats.agents_chine }}</strong></li>
                        <li><i class="fas fa-user-shield text-success"></i> Utilisateurs connectés: <strong>{{ stats.users_connected }}</strong></li>
                    </ul>
                </div>
            </div>
            <div class="card-footer">
                <button class="btn btn-warning" disabled>
                    <i class="fas fa-file-alt"></i> Consulter les Logs (Bientôt)
                </button>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card border-warning">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="fas fa-tools"></i> Zone de Développement</h5>
            </div>
            <div class="card-body">
                <p class="mb-3">
                    <strong>Note :</strong> Cette page de paramètres est actuellement en développement. 
                    Les fonctionnalités avancées seront disponibles dans une future mise à jour.
                </p>
                <div class="row">
                    <div class="col-md-4">
                        <h6>Fonctionnalités disponibles :</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check text-success"></i> Gestion des transferts</li>
                            <li><i class="fas fa-check text-success"></i> Gestion des agents</li>
                            <li><i class="fas fa-check text-success"></i> Rapports financiers</li>
                            <li><i class="fas fa-check text-success"></i> Dashboard complet</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6>En cours de développement :</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-clock text-warning"></i> Configuration avancée</li>
                            <li><i class="fas fa-clock text-warning"></i> Système de sauvegarde</li>
                            <li><i class="fas fa-clock text-warning"></i> Monitoring temps réel</li>
                            <li><i class="fas fa-clock text-warning"></i> Logs détaillés</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6>Prochaines versions :</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-plus text-info"></i> API REST complète</li>
                            <li><i class="fas fa-plus text-info"></i> Application mobile</li>
                            <li><i class="fas fa-plus text-info"></i> Intégrations tierces</li>
                            <li><i class="fas fa-plus text-info"></i> BI avancé</li>
                    </ul>
                </div>
                
            </div>
        </div>
    </div>
    </div>
</div>
{% endblock %}
